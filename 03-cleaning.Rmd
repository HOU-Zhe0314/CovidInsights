# Data transformation

## Hospital Visits Data
We first got the data by using the COVIDcast Epidata API. This data is the estimated percentage of COVID-related doctor's vistis, based on the outpatient visits. The outpatient visits data comes from Carnegie Mellon University's health system partners.
The estimation works as follows:
For a fixed time t and location i, there are counts of Covid-like symptoms, Flu-like symptoms, Mixed symptoms, Clealy-Flu symptoms, and total counts of visits. Then estimate the percentage of COVID-like symptoms as:

**100 * (CovidLike + FluLike + Mixed - ClearlyFlu) / total**

To enhance variablility, a local linear regression filter with a Gaussian kernel is applied, the bandwidth is set to 7 to cover a rolling 7-day window.
```{r}
#install.packages("covidcast")
library(covidcast)
library(tidyverse)
library(patchwork)
```
```{r}
doctor_visit_data_raw <- covidcast_signal("doctor-visits", "smoothed_cli", start_day = "2020-02-01", end_day = "2021-02-01", geo_type='state',geo_values=c('ny','ca','ak','co','hi','wa','ks','va','mo'))
```

Note that we only picked nine states for analysis: 2 from west coast (CA, WA), 2 from east coast (NY, VA), 2 from middle (CO, KS, MO), and two relatively remote states (HI, AK). And we analyzed data from 2020-02-01 to 2021-02-01.

However, after smoothing the data, the standard error estimate is claimed to be inaccurate any more, so the standard error appears to be missing the dataset and we just removed the column. 
```{r}
doctor_visit_data <- doctor_visit_data_raw[c('geo_value','time_value','value')]
```
Hence, the resulting variables in the dataset are: 'location', 'time', 'smoothed estimated percentage of COVID-related doctor's vistis'. 

## Hospital Admissions Data
This data is also retrieved using COVIDcast Epidata API. It is the data of the estimated percentage of new hospital admissions with COVID-related symptoms. The data also comes from Carnegie Mellon University's health system partners. 
```{r, message=F, warning=F}
hospital_data_raw <- covidcast_signal("hospital-admissions", "smoothed_covid19_from_claims", start_day = "2020-02-01", end_day = "2021-02-01", geo_type='state',geo_values=c('ny','ca','ak','co','hi','wa','ks','va','mo'))
```

For consistency, we also picked the nine states and the same time interval.
This data went through the same smoothing adjustment as above. So for the same reason, we removed the columns associated with standard error.

```{r}
hospital_data <- hospital_data_raw[c('geo_value','time_value','value')]
```

The resulting variables are: 'location', 'time', 'smoothed estimated percentage of new hospital admissions related to COVID'.



                                                      